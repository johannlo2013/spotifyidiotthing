<!DOCTYPE html>
<html>
<head>
    <title>Spotify Car Interface</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #121212;
            color: white;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        #startButton {
            padding: 1rem 2rem;
            font-size: 1.2rem;
            background: #1DB954;
            color: white;
            border: none;
            border-radius: 2rem;
            cursor: pointer;
            transition: transform 0.2s;
        }

        #startButton:hover {
            transform: scale(1.05);
        }

        #player {
            display: none;
            width: 480px;
            height: 360px;
            background: #282828;
            border-radius: 1rem;
            padding: 1rem;
            position: relative;
        }

        #albumArt {
            width: 200px;
            height: 200px;
            border-radius: 0.5rem;
            margin: 0 auto;
            background: #181818;
            display: block;
        }

        .track-info {
            text-align: center;
            margin: 1rem 0;
        }

        #trackName {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        #artistName {
            font-size: 1rem;
            color: #b3b3b3;
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: #404040;
            border-radius: 2px;
            margin: 1rem 0;
            position: relative;
        }

        .progress {
            height: 100%;
            background: #1DB954;
            border-radius: 2px;
            width: 0%;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 1rem;
        }

        .control-button {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            background: #404040;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .control-button:hover {
            background: #505050;
        }

        .time-display {
            display: flex;
            justify-content: space-between;
            color: #b3b3b3;
            font-size: 0.8rem;
        }
    </style>
</head>
<body>
    <button id="startButton">Start Spotify</button>

    <div id="player">
        <img id="albumArt" src="" alt="Album artwork">
        <div class="track-info">
            <div id="trackName">Track Name</div>
            <div id="artistName">Artist Name</div>
        </div>
        <div class="progress-bar">
            <div class="progress"></div>
        </div>
        <div class="time-display">
            <span id="currentTime">0:00</span>
            <span id="duration">0:00</span>
        </div>
        <div class="controls">
            <button class="control-button" id="prevButton">⏮</button>
            <button class="control-button" id="playButton">⏵</button>
            <button class="control-button" id="nextButton">⏭</button>
        </div>
    </div>

    <script>
        // Replace these with your own Spotify API credentials
        const CLIENT_ID = '193c038b988e474496a09b04f0f8131b';
        const REDIRECT_URI = 'https://spotifyidiotthing.vercel.app';

        const startButton = document.getElementById('startButton');
        const player = document.getElementById('player');
        
        startButton.addEventListener('click', () => {
            const scopes = 'user-read-playback-state user-modify-playback-state';
            const authUrl = `https://accounts.spotify.com/authorize?client_id=${CLIENT_ID}&response_type=token&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&scope=${encodeURIComponent(scopes)}`;
            window.location.href = authUrl;
        });

        // Check if we're returning from Spotify auth
        if (window.location.hash) {
            const token = window.location.hash.substr(1).split('&')[0].split('=')[1];
            startButton.style.display = 'none';
            player.style.display = 'block';
            document.documentElement.requestFullscreen();
            initializePlayer(token);
        }

        function initializePlayer(token) {
            const playButton = document.getElementById('playButton');
            const prevButton = document.getElementById('prevButton');
            const nextButton = document.getElementById('nextButton');
            const progress = document.querySelector('.progress');
            const currentTimeDisplay = document.getElementById('currentTime');
            const durationDisplay = document.getElementById('duration');

            let isPlaying = false;

            function formatTime(ms) {
                const seconds = Math.floor((ms / 1000) % 60);
                const minutes = Math.floor((ms / 1000) / 60);
                return `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }

            async function updatePlayerState() {
                try {
                    const response = await fetch('https://api.spotify.com/v1/me/player', {
                        headers: { 'Authorization': `Bearer ${token}` }
                    });
                    
                    if (response.status === 204) return;
                    
                    const data = await response.json();
                    
                    document.getElementById('trackName').textContent = data.item.name;
                    document.getElementById('artistName').textContent = data.item.artists[0].name;
                    document.getElementById('albumArt').src = data.item.album.images[0].url;
                    
                    isPlaying = data.is_playing;
                    playButton.textContent = isPlaying ? '⏸' : '⏵';
                    
                    const progressPercent = (data.progress_ms / data.item.duration_ms) * 100;
                    progress.style.width = `${progressPercent}%`;
                    
                    currentTimeDisplay.textContent = formatTime(data.progress_ms);
                    durationDisplay.textContent = formatTime(data.item.duration_ms);
                } catch (error) {
                    console.error('Error updating player state:', error);
                }
            }

            playButton.addEventListener('click', async () => {
                const endpoint = isPlaying ? 'pause' : 'play';
                try {
                    await fetch(`https://api.spotify.com/v1/me/player/${endpoint}`, {
                        method: 'PUT',
                        headers: { 'Authorization': `Bearer ${token}` }
                    });
                    updatePlayerState();
                } catch (error) {
                    console.error('Error toggling playback:', error);
                }
            });

            prevButton.addEventListener('click', async () => {
                try {
                    await fetch('https://api.spotify.com/v1/me/player/previous', {
                        method: 'POST',
                        headers: { 'Authorization': `Bearer ${token}` }
                    });
                    updatePlayerState();
                } catch (error) {
                    console.error('Error skipping to previous:', error);
                }
            });

            nextButton.addEventListener('click', async () => {
                try {
                    await fetch('https://api.spotify.com/v1/me/player/next', {
                        method: 'POST',
                        headers: { 'Authorization': `Bearer ${token}` }
                    });
                    updatePlayerState();
                } catch (error) {
                    console.error('Error skipping to next:', error);
                }
            });

            // Update player state every second
            setInterval(updatePlayerState, 1000);
            updatePlayerState();
        }
    </script>
</body>
</html>